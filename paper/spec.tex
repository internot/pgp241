\documentclass[runningheads,a4paper]{llncs}[2018/03/10]

\newif\ifanon
\anonfalse

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{color}
\usepackage{paralist}
\usepackage{xspace}
\usepackage{syntax}
\usepackage{balance}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{enumitem}
\usepackage{csquotes}
\usepackage{xcolor}

\makeatletter
\newcommand{\shorteq}{%
  \settowidth{\@tempdima}{-}% Width of hyphen
  \resizebox{\@tempdima}{\height}{=}%
}
\makeatother

\definecolor{linkcolor}{rgb}{0,0,1}
\definecolor{citecolor}{rgb}{0,0,1}
\definecolor{urlcolor}{rgb}{0,0,1}
\usepackage[colorlinks=true, backref=page, linkcolor=linkcolor, urlcolor=urlcolor, citecolor=citecolor]{hyperref} 

\begin{document}
\ifanon
\else
	\author{Jonas Magazinius Nadim Kobeissi}
	\institute{
		Assured\\
		\email{jonas.magazinius@assured.se}
	}
	% I've not left you out, I just couldn't figure out how to add multiple authors without fucking up the layout and didn't want to spend time on it.
\fi

\title{OpenPGP 2-4-1: Merging two messages in one ciphertext}
\maketitle

\begin{abstract}
	{ASD}
\end{abstract}

\begin{keywords}
	OpenPGP
\end{keywords}

\section{Introduction}\label{sec:intro}
This is intro!

\section{Background}\label{sec:background}


\section{OpenPGP}\label{sec:openpgp}


\subsection{CFB mode}



\subsubsection{OpenPGP CFB mode}

OpenPGP implements CFB mode slightly differently compared to standard 
CFB mode. Instead of encrypting an IV and XOR it with the first block 
of plaintext a block of zeroes is encrypted and XORed with a random 
number, acting as an IV.

$
C_1 = E(0) \oplus R \\
|C_2|_{a}
$


\subsubsection{Properties of CFB mode}

To start out, let us note some important properties concerning modification of a 
ciphertext encrypted in CFB mode. It is important to note that neither of these 
properties depend on the encryption key, which implies that knowing the key is 
not required to abuse them. The properties have historically been abused, and 
will again be abused in Section X, to attack the PGP message format.



\paragraph{Property 1} The ciphertext will have the exact length of
the ciphertext and vice versa. A modification of the length of the
ciphertext will cause the same effect on the plaintext. Any number of
bytes cut off the end of the ciphertext will cut the same amount of
bytes from the plaintext.
 
\paragraph{Property 2} The decryption of a block depends only on the
preceding block, regardless of where in the ciphertext it
appears. Blocks can also be injected amidst two blocks, affecting only
the first and last block of the injected sequence. As a result, any
sequence of ciphertext blocks can be cut, duplicated or moved between
blocks in the ciphertext, and still produce the same plaintext. The
decrypted output of the first block of the two and the block following
the second will however be garbled. This means an attacker can inject
these two blocks amidst blocks in the ciphertext and the decrypted
output will be one block of random data and one with arbitrary
attacker chosen text.


\paragraph{Property 3} When decrypting, the plaintext stands in direct
relation to the ciphertext. A flipped bit in the ciphertext causes the
same bit to be flipped in the plaintext. By extension, if the
plaintext of a block, or part of a block is known, that part of the
plaintext can be arbitrarily and reliably modified to produce any
text. Of course, modifying the ciphertext will cause the plaintext of
the following block to be scrambled. If the modified block is the last
block of the sequence, there will be no block to scramble.


\subsection{The OpenPGP message format}

A PGP message consists of a set of packets. Each packet has a header consisting 
of a one byte tag and a variable
number of bytes describing the total size of the packet. Five kinds of
packets are of particular interest for this article, Literal,
Compressed, Symmetrically Encrypted (SE), Symmetrically Encrypted
Integrity Protected (SEIP), and Modification Detection Code (MDC)
packets. For a complete description of the PGP message format the
reader is referred to the PGP standard documentation, RFC4880.

The OpenPGP message format is specified and refined in RFCs 1991,
2440, and finally standardised in RFC
4880~\cite{callas1998rfc,callas2007openpgp}.

Of particular interest are symmetrically encrypted packets, both with
and without integrity protection.


\section{Two for one}\label{sec:twoforone}

The "Two for One" attack merges two messages, encrypted with different session keys, 
into a single ciphertext. The plaintext, when decrypted with the first key, 
corresponds to a Literal-packet followed by a Marker-packet. When decrypted with the second 
key, the first packet is the Marker-packet and the second the Literal packet. 
Since, upon decryption, the Marker-packet will be ignored, only the contents of the Literal-packet will be returned. This allows an attacker to send an encrypted message to different recipients, each receiving different keys, which will decrypt to different texts.


This works because the two decrypted plaintexts both contains two representations 
of packets. The plaintexts agree on the size and location of the packets, but 
disagree on their type. Apart 
from the packet header, the Marker-packets in both cases contain random garbage 
data. 

Steps:
1. Pick a ciphertext for the first block.
2. Find two keys that encrypts that cipher text such that the output fulfil the quick check constraint.
3.

\section{Conclusion}\label{sec:conclusion}
Well, wasn't this awesome!

\section*{Acknowledgments}
\ifanon
	Removed for blind review.
\else
	
\fi

\clearpage

\bibliographystyle{unsrt}
\bibliography{spec}


\end{document}
